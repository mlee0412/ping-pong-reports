<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Space Ops ‚Äî Management System</title>
<style>
  :root{
    --bg:#0b0f14;
    --bg-2:#0d1219;
    --surface:#121826;
    --elev:#0f1522;
    --text:#e6f1ff;
    --muted:#9bb0c9;
    --primary:#00e5ff;
    --primary-2:#8a2be2;
    --ok:#34d399;
    --warn:#f59e0b;
    --bad:#ef4444;
    --glow:0 0 24px rgba(0,229,255,.35), 0 0 8px rgba(138,43,226,.25);
    --radius:14px;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font:14px/1.5 ui-sans-serif, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, system-ui;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 10% -20%, rgba(0,229,255,.08), transparent 60%),
      radial-gradient(1000px 700px at 120% 10%, rgba(138,43,226,.08), transparent 50%),
      linear-gradient(180deg, var(--bg), var(--bg-2));
  }
  a{color:inherit;text-decoration:none}
  .app{
    display:grid;
    grid-template-columns: 260px 1fr;
    min-height:100dvh;
    position:relative;
  }
  /* Collapsible Sidebar */
  .sidebar{
    position:sticky; top:0; align-self:start;
    height:100dvh;
    background:linear-gradient(180deg, rgba(18,24,38,.9), rgba(18,24,38,.6));
    border-right:1px solid rgba(255,255,255,.06);
    padding:18px 16px;
    backdrop-filter: blur(10px);
    transition: width 0.3s ease, transform 0.3s ease;
    overflow:hidden;
    width:260px;
  }
  .sidebar.collapsed{
    width:72px;
  }
  .toggle-sidebar{
    position:absolute;
    right:10px;
    top:10px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    border-radius:8px;
    padding:4px 8px;
    cursor:pointer;
    transition:.18s ease;
  }
  .toggle-sidebar:hover{
    background:rgba(255,255,255,.1);
    border-color:rgba(0,229,255,.5);
  }
  .brand{
    display:flex;align-items:center;gap:12px;padding:10px 8px;margin-bottom:10px;
    position:relative;
  }
  .logo{
    width:36px;height:36px;border-radius:10px;
    background: linear-gradient(135deg, #00e5ff, #8a2be2);
    box-shadow: var(--glow);
    position:relative;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    font-weight:bold;
    color:white;
  }
  .logo:after{
    content:"S"; 
    position:absolute; 
    font-family: 'Arial Black', sans-serif;
  }
  .brand h1{
    font-size:15px;
    letter-spacing:.2em;
    margin:0;
    text-transform:uppercase;
    color:#c9e7ff;
    white-space:nowrap;
  }
  .sidebar.collapsed .brand h1{
    display:none;
  }
  .nav{
    margin-top:8px;
    display:flex; flex-direction:column; gap:6px;
  }
  .nav button{
    appearance:none;border:0;background:transparent;color:var(--text);
    text-align:left;padding:12px 12px;border-radius:12px;display:flex;align-items:center;gap:10px;
    transition:.18s ease; cursor:pointer;
    white-space:nowrap;
    overflow:hidden;
  }
  .nav button:hover{background:#182236}
  .nav button.active{background:linear-gradient(90deg, rgba(0,229,255,.15), rgba(138,43,226,.08)); box-shadow: var(--glow)}
  .nav .tag{margin-left:auto;font-size:12px;opacity:.8;padding:2px 8px;border-radius:999px;background:#182236}
  .sidebar.collapsed .nav .label,
  .sidebar.collapsed .nav .tag{display:none}
  .sidebar .mini{
    display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:14px 2px;
  }
  .sidebar.collapsed .mini{
    grid-template-columns:1fr;
  }
  .chip{
    padding:10px 12px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#0e1524;cursor:pointer;text-align:center;
    overflow:hidden;
  }
  .chip:hover{border-color:rgba(0,229,255,.5); box-shadow:var(--glow)}
  .sidebar.collapsed .chip .muted{display:none}
  .foot{
    position:absolute; bottom:14px; left:16px; right:16px; opacity:.9; font-size:12px;
    border-top:1px solid rgba(255,255,255,.08); padding-top:10px;
  }
  .sidebar.collapsed .foot{display:none}
  /* Main */
  .main{
    min-width:0; display:flex; flex-direction:column;
  }
  .topbar{
    position:sticky; top:0; z-index:5;
    display:flex; align-items:center; gap:12px;
    padding:12px 16px; border-bottom:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(11,15,20,.8), rgba(11,15,20,.45));
    backdrop-filter: blur(6px);
  }
  .search{
    flex:1; display:flex; align-items:center; gap:10px;
    background:#0e1524; border:1px solid rgba(255,255,255,.08); border-radius:999px; padding:8px 12px;
    position:relative;
  }
  .search input{
    border:0;background:transparent; color:var(--text); outline:none; width:100%;
  }
  .search-buttons{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .search-btn{
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.1);
    border-radius:8px;
    padding:6px 10px;
    cursor:pointer;
    transition:.18s ease;
    font-size:12px;
  }
  .search-btn:hover{
    background:rgba(0,229,255,.15);
    border-color:rgba(0,229,255,.5);
  }
  .btn{
    appearance:none; border:1px solid rgba(255,255,255,.1); background:#101826; color:var(--text);
    padding:10px 14px; border-radius:12px; cursor:pointer; transition:.18s ease; display:inline-flex; align-items:center; gap:8px;
  }
  .btn:hover{border-color:rgba(0,229,255,.6); box-shadow:var(--glow)}
  .btn.primary{background:linear-gradient(90deg, rgba(0,229,255,.15), rgba(138,43,226,.15)); border-color:rgba(0,229,255,.35)}
  .btn.ghost{background:transparent}
  .btn.danger{background:rgba(239,68,68,.15); border-color:rgba(239,68,68,.35)}
  .avatar{
    width:36px;
    height:36px;
    border-radius:10px;
    background: linear-gradient(135deg, #00e5ff, #8a2be2);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    font-weight:bold;
    color:white;
    box-shadow: var(--glow);
  }
  .views{padding:18px; display:grid; gap:18px;}
  .view{display:none;}
  .view.active{display:block;}
  .grid{
    display:grid; gap:16px;
  }
  .kpis{grid-template-columns: repeat(4, minmax(0,1fr));}
  .card{
    background:linear-gradient(180deg, rgba(16,24,38,.9), rgba(16,24,38,.7));
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px; min-height:72px;
  }
  .card h3{margin:0 0 8px 0; font-weight:600; font-size:14px; color:#cde6ff}
  .big{font-size:28px; font-weight:700; letter-spacing:.5px}
  .muted{color:var(--muted)}
  .row{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
  .split{display:grid; grid-template-columns: 1.2fr .8fr; gap:16px;}
  /* Weather Widget */
  .weather-widget{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .weather-main{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .weather-icon{
    font-size:32px;
  }
  .weather-info{
    display:flex;
    flex-direction:column;
  }
  .weather-temp{
    font-size:24px;
    font-weight:bold;
  }
  .weather-desc{
    font-size:12px;
    color:var(--muted);
  }
  /* Floor Grid */
  .floor-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:16px;
  }
  .location-selector{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .location-dropdown{
    background:#0e1524;
    border:1px solid rgba(255,255,255,.08);
    color:var(--text);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
  }
  .floor-grid{
    display:grid;
    grid-template-columns: repeat(14, minmax(0,1fr));
    grid-template-rows: repeat(6, minmax(80px,1fr));
    gap:8px;
    padding:12px;
    background:rgba(0,0,0,.2);
    border-radius:12px;
    min-height:480px;
  }
  .table-card{
    background:#0f1525;
    border:1px solid rgba(255,255,255,.06);
    border-radius:12px;
    padding:8px;
    cursor:pointer;
    transition:.18s ease;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
  }
  .table-card:hover{
    border-color:rgba(0,229,255,.5);
    box-shadow:var(--glow);
  }
  .table-card.square{
    grid-column:span 1;
    grid-row:span 1;
  }
  .table-card.rectangle{
    grid-column:span 2;
    grid-row:span 1;
  }
  .table-card.circle{
    grid-column:span 1;
    grid-row:span 1;
    border-radius:50%;
  }
  .table-name{
    font-weight:bold;
    font-size:14px;
    margin-bottom:4px;
  }
  .table-timer{
    font-size:12px;
    color:var(--muted);
  }
  .table-status-indicator{
    position:absolute;
    top:4px;
    right:4px;
    width:8px;
    height:8px;
    border-radius:50%;
  }
  .table-status-indicator.available{background:var(--ok)}
  .table-status-indicator.occupied{background:var(--warn)}
  .table-status-indicator.reserved{background:var(--bad)}
  /* Reservation Table */
  .location-buttons{
    display:flex;
    gap:8px;
    margin:12px 0;
  }
  .location-btn{
    padding:8px 16px;
    border:1px solid rgba(255,255,255,.08);
    background:#0e1524;
    color:var(--text);
    border-radius:8px;
    cursor:pointer;
    transition:.18s ease;
  }
  .location-btn:hover,
  .location-btn.active{
    background:rgba(0,229,255,.15);
    border-color:rgba(0,229,255,.5);
  }
  .status{font-size:12px; padding:4px 8px; border-radius:999px; width:max-content}
  .s-ok{background:rgba(52,211,153,.15); color:#a7f3d0}
  .s-busy{background:rgba(245,158,11,.15); color:#fde68a}
  .s-off{background:rgba(239,68,68,.15); color:#fecaca}
  .list{display:grid; gap:8px}
  .item{
    padding:12px; border-radius:12px; background:#0f1525; border:1px solid rgba(255,255,255,.06);
    display:flex; align-items:center; gap:12px; justify-content:space-between;
  }
  .tabs{display:flex; gap:8px; flex-wrap:wrap}
  .tab{padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.08); background:#0e1524; cursor:pointer}
  .tab.active{border-color:rgba(0,229,255,.6); box-shadow:var(--glow)}
  .table{
    width:100%; border-collapse:separate; border-spacing:0 8px;
  }
  .table th{font-size:12px; color:#b9d7ff; text-align:left; padding:8px 10px}
  .table td{
    background:#0f1525; border:1px solid rgba(255,255,255,.06);
    padding:10px; border-left-width:1px; border-right-width:1px;
  }
  .table tr td:first-child{border-top-left-radius:10px; border-bottom-left-radius:10px}
  .table tr td:last-child{border-top-right-radius:10px; border-bottom-right-radius:10px}
  .action-btns{
    display:flex;
    gap:4px;
  }
  .icon-btn{
    padding:6px;
    border-radius:6px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    cursor:pointer;
    transition:.18s ease;
  }
  .icon-btn:hover{
    background:rgba(0,229,255,.15);
    border-color:rgba(0,229,255,.5);
  }
  /* Settings Panel */
  .settings-section{
    margin-bottom:24px;
  }
  .settings-section h4{
    color:#c9e7ff;
    margin-bottom:12px;
    font-size:16px;
  }
  .setting-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px;
    background:#0f1525;
    border:1px solid rgba(255,255,255,.06);
    border-radius:10px;
    margin-bottom:8px;
  }
  .toggle-switch{
    position:relative;
    width:48px;
    height:24px;
    background:#182236;
    border-radius:999px;
    cursor:pointer;
    transition:.3s ease;
  }
  .toggle-switch.active{
    background:var(--primary);
  }
  .toggle-switch:after{
    content:'';
    position:absolute;
    width:20px;
    height:20px;
    background:white;
    border-radius:50%;
    top:2px;
    left:2px;
    transition:.3s ease;
  }
  .toggle-switch.active:after{
    transform:translateX(24px);
  }
  /* Schedule View */
  .schedule-calendar{
    display:grid;
    grid-template-columns:repeat(7, 1fr);
    gap:8px;
    margin-top:16px;
  }
  .calendar-day{
    padding:12px;
    background:#0f1525;
    border:1px solid rgba(255,255,255,.06);
    border-radius:10px;
    min-height:100px;
  }
  .calendar-day-header{
    font-weight:bold;
    color:#c9e7ff;
    margin-bottom:8px;
  }
  .calendar-event{
    font-size:12px;
    padding:4px 6px;
    background:rgba(0,229,255,.15);
    border-radius:6px;
    margin-bottom:4px;
  }
  /* AI Agent Panel */
  .ai-panel{
    height:100%;
    display:flex;
    flex-direction:column;
  }
  .ai-chat{
    flex:1;
    overflow-y:auto;
    padding:12px;
    background:rgba(0,0,0,.2);
    border-radius:12px;
    margin:12px 0;
  }
  .ai-message{
    padding:10px;
    margin-bottom:8px;
    border-radius:10px;
  }
  .ai-message.user{
    background:rgba(0,229,255,.15);
    margin-left:20%;
  }
  .ai-message.assistant{
    background:rgba(138,43,226,.15);
    margin-right:20%;
  }
  .ai-input-area{
    display:flex;
    gap:8px;
    padding:12px;
    background:#0f1525;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
  }
  .ai-input{
    flex:1;
    background:transparent;
    border:none;
    color:var(--text);
    outline:none;
  }
  .ai-input-buttons{
    display:flex;
    gap:4px;
  }
  .ai-prompts{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:8px;
  }
  .ai-prompt-chip{
    padding:6px 12px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    border-radius:999px;
    font-size:12px;
    cursor:pointer;
    transition:.18s ease;
  }
  .ai-prompt-chip:hover{
    background:rgba(0,229,255,.15);
    border-color:rgba(0,229,255,.5);
  }
  /* Drawer & Modal */
  .drawer{
    position:fixed; top:0; right:-480px; width:480px; height:100dvh;
    background:linear-gradient(180deg, rgba(16,24,38,.98), rgba(16,24,38,.92));
    border-left:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow);
    transition:.3s ease; z-index:20; padding:16px;
    display:flex;
    flex-direction:column;
  }
  .drawer.open{right:0}
  .modal-bg{
    position:fixed; inset:0; background:rgba(5,9,14,.6); backdrop-filter: blur(2px);
    display:none; align-items:center; justify-content:center; z-index:30;
  }
  .modal-bg.show{display:flex}
  .modal{
    width:min(720px, 92vw); background:#0f1525; border:1px solid rgba(255,255,255,.08);
    border-radius:16px; padding:18px; box-shadow: var(--shadow);
  }
  .modal .actions{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}
  .field{display:grid; gap:6px; margin:8px 0}
  .field label{color:#c9e7ff; font-size:13px}
  .field input,.field select,.field textarea{
    background:#0b1220; color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:10px; outline:none;
  }
  .toast-wrap{position:fixed; bottom:16px; right:16px; display:grid; gap:8px; z-index:40}
  .toast{background:#0f1525; border:1px solid rgba(255,255,255,.08); padding:12px 14px; border-radius:12px; min-width:260px; box-shadow:var(--shadow)}
  .kbd{padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.2); background:#0d1422; font-size:12px}
  /* Command palette */
  .palette{position:fixed; inset:0; display:none; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:50; background:rgba(0,0,0,.35); backdrop-filter: blur(2px)}
  .palette.show{display:flex}
  .palette .box{width:min(720px, 92vw); background:#0f1525; border:1px solid rgba(255,255,255,.12); border-radius:14px; overflow:hidden; box-shadow:var(--shadow)}
  .palette .box header{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; gap:10px}
  .palette .box input{width:100%; background:transparent; border:0; color:var(--text); outline:none; font-size:16px}
  .palette .list{max-height:46vh; overflow:auto}
  .palette .list button{width:100%; text-align:left; padding:12px; background:transparent; border:0; color:var(--text); cursor:pointer}
  .palette .list button:hover{background:#141c2f}
  /* Responsive */
  @media (max-width: 960px){
    .app{grid-template-columns: 72px 1fr;}
    .sidebar{width:72px}
    .brand h1{display:none}
    .nav .label{display:none}
    .split{grid-template-columns: 1fr}
    .floor-grid{grid-template-columns: repeat(7, minmax(0,1fr))}
  }
  @media (max-width: 560px){
    .kpis{grid-template-columns: repeat(2, minmax(0,1fr))}
    .floor-grid{grid-template-columns: repeat(4, minmax(0,1fr))}
  }
  /* Light theme */
  body.light{
    --bg:#f6f9ff;
    --bg-2:#eef3ff;
    --surface:#ffffff;
    --elev:#f7fbff;
    --text:#0b1220;
    --muted:#516178;
    --primary:#0099cc;
    --primary-2:#6a1b9a;
  }
  body.light .sidebar,
  body.light .card,
  body.light .table-card,
  body.light .item,
  body.light .modal,
  body.light .drawer{
    background:#ffffff;
  }
  body.light .sidebar{background:#f5f9ff}
  body.light .nav button:hover{background:#eaf2ff}
  body.light .nav button.active{background:linear-gradient(90deg, rgba(0,153,204,.12), rgba(106,27,154,.08))}
  body.light .search,
  body.light .location-dropdown,
  body.light .location-btn,
  body.light .field input,
  body.light .field select,
  body.light .field textarea{
    background:#eef3ff;
    color:#0b1220;
  }
  body.light .table td{background:#f7fbff}
  body.light .btn{background:#f0f6ff; color:#0b1220}
  body.light .btn:hover{background:#e0efff}
  body.light .btn.primary{background:linear-gradient(90deg, rgba(0,153,204,.15), rgba(106,27,154,.15))}
  body.light .setting-item,
  body.light .calendar-day{background:#f7fbff}
  body.light .floor-grid{background:rgba(0,0,0,.05)}
  body.light .ai-chat{background:rgba(0,0,0,.03)}
</style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <button class="toggle-sidebar" id="toggleSidebar">‚ò∞</button>
    <div class="brand">
      <div class="logo" id="spaceLogo" title="Return to Dashboard"></div>
      <h1>SPACE OPS</h1>
    </div>
    <div class="nav">
      <button class="active" data-route="dashboard">üè† <span class="label">Dashboard</span></button>
      <button data-route="floor">üéØ <span class="label">Floor</span> <span class="tag">Live</span></button>
      <button data-route="automations">‚öôÔ∏è <span class="label">Automations</span></button>
      <button data-route="inventory">üì¶ <span class="label">Inventory</span></button>
      <button data-route="tasks">üóÇÔ∏è <span class="label">Tasks</span></button>
      <button data-route="schedule">üìÖ <span class="label">Schedule</span></button>
      <button data-route="settings">üõ†Ô∏è <span class="label">Settings</span></button>
    </div>
    <div class="mini">
      <div class="chip" data-open-palette>‚åòK<br><span class="muted">Command</span></div>
      <div class="chip" data-open-drawer>üß†<br><span class="muted">Agent</span></div>
    </div>
    <div class="foot muted">
      <div id="appTips">Tip: Use voice commands for hands-free control</div>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <div class="topbar">
      <div class="search" role="search">
        üîé <input placeholder="Search reservations, tables, activities, settings..." aria-label="Search"/>
        <div class="search-buttons">
          <button class="search-btn" title="Voice Search">üé§</button>
          <button class="search-btn" title="Upload Image">üì∑</button>
          <button class="search-btn" title="AI Mode">ü§ñ</button>
        </div>
      </div>
      <button class="btn ghost" id="themeBtn">üåó Theme</button>
      <button class="btn" data-action="sync-supabase">üîÑ Sync</button>
      <button class="btn primary" id="startEndDay">üåÖ Start Day</button>
      <div class="avatar" id="spaceLogo2">S</div>
    </div>

    <div class="views">
      <!-- DASHBOARD -->
      <div class="view active" id="view-dashboard">
        <div class="grid kpis">
          <div class="card">
            <div class="weather-widget">
              <h3>Weather</h3>
              <div class="weather-main">
                <span class="weather-icon">‚òÄÔ∏è</span>
                <div class="weather-info">
                  <span class="weather-temp">72¬∞F</span>
                  <span class="weather-desc">Clear skies</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <h3>Active Tables</h3>
            <div class="big" id="kpi-active">7</div>
            <div class="muted">+2 since 1 hr ago</div>
          </div>
          <div class="card">
            <h3>Avg Session</h3>
            <div class="big">01:12</div>
            <div class="muted">All activities</div>
          </div>
          <div class="card">
            <h3>Revenue Today</h3>
            <div class="big">$4,820</div>
            <div class="muted">Target $6,500</div>
          </div>
        </div>

        <div class="split">
          <div class="card">
            <div class="row" style="justify-content:space-between">
              <div class="row"><h3 style="margin:0">Quick Actions</h3></div>
              <div class="tabs" role="tablist" data-tabs="zones">
                <button class="tab active" data-zone="Ping Pong" role="tab">üèì Ping Pong</button>
                <button class="tab" data-zone="iGolf" role="tab">‚õ≥ iGolf</button>
                <button class="tab" data-zone="Karaoke" role="tab">üé§ Karaoke</button>
                <button class="tab" data-zone="Billiards" role="tab">üé± Billiards</button>
              </div>
            </div>
            <div class="row" style="margin-top:10px">
              <button class="btn primary" data-open="new-session" data-zone="Ping Pong">‚ûï Start Session</button>
              <button class="btn" data-open="schedule-form">üìÖ Schedule</button>
              <button class="btn" data-open="order-form">üìù Order Form</button>
              <button class="btn" data-workflow="music-vibe">üéµ Play Vibe</button>
            </div>
          </div>

          <div class="card">
            <h3>Recent Activity</h3>
            <div class="list" id="activity">
              <!-- JS injects events -->
            </div>
          </div>
        </div>

        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:0">Today's Reservations</h3>
            <button class="btn" data-workflow="sync-calendar">üìÖ Pull from Google Calendar</button>
          </div>
          <div class="location-buttons">
            <button class="location-btn active">üèì Ping Pong</button>
            <button class="location-btn">‚õ≥ iGolf</button>
            <button class="location-btn">üé§ Karaoke</button>
            <button class="location-btn">üé± Billiards</button>
          </div>
          <table class="table" aria-label="Reservations">
            <thead>
              <tr>
                <th>Time (Duration)</th>
                <th>Name (Host)</th>
                <th>Guests</th>
                <th>Sales Type</th>
                <th>Details</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
          </table>
        </div>
      </div>

      <!-- FLOOR -->
      <div class="view" id="view-floor">
        <div class="card">
          <div class="floor-header">
            <div class="location-selector">
              <h3 style="margin:0">Floor Grid</h3>
              <select class="location-dropdown">
                <option>üèì Ping Pong</option>
                <option>‚õ≥ iGolf</option>
                <option>üé§ Karaoke</option>
                <option>üé± Billiards</option>
              </select>
            </div>
            <div class="row">
              <button class="btn" data-workflow="floor-refresh">üîÉ Refresh</button>
              <button class="btn" data-open="edit-floor-plan">üó∫Ô∏è Edit Floor Plan</button>
            </div>
          </div>
          <div class="floor-grid" id="floorGrid">
            <!-- Table cards will be dynamically placed here -->
          </div>
        </div>
      </div>

      <!-- AUTOMATIONS -->
      <div class="view" id="view-automations">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:0">Workflows (Spotify Enabled)</h3>
            <div class="row">
              <button class="btn primary" data-open="new-workflow">‚ûï New Workflow</button>
              <button class="btn" data-workflow="deploy">‚¨ÜÔ∏è Deploy</button>
            </div>
          </div>
          <div class="list" id="wfList"></div>
        </div>
      </div>

      <!-- INVENTORY -->
      <div class="view" id="view-inventory">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:0">Inventory</h3>
            <div class="row">
              <button class="btn" data-action="recalc-par">üßÆ Recalc PAR</button>
              <button class="btn primary" data-workflow="create-po">üìù Create PO</button>
            </div>
          </div>
          <table class="table" aria-label="Inventory">
            <thead><tr><th>Item</th><th>On Hand</th><th>PAR</th><th>Vendor</th><th>Status</th><th>Action</th></tr></thead>
            <tbody id="invBody"></tbody>
          </table>
        </div>
      </div>

      <!-- TASKS -->
      <div class="view" id="view-tasks">
        <div class="grid" style="grid-template-columns: repeat(3, minmax(0,1fr));">
          <div class="card"><h3>Backlog</h3><div class="list" id="col-backlog"></div></div>
          <div class="card"><h3>Doing</h3><div class="list" id="col-doing"></div></div>
          <div class="card"><h3>Done</h3><div class="list" id="col-done"></div></div>
        </div>
      </div>

      <!-- SCHEDULE -->
      <div class="view" id="view-schedule">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:0">Schedule Management</h3>
            <button class="btn primary" data-open="new-booking">‚ûï New Booking</button>
          </div>
          <div class="schedule-calendar" id="scheduleCalendar">
            <!-- Calendar view will be rendered here -->
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div class="view" id="view-settings">
        <div class="card">
          <h3>System Settings</h3>
          
          <div class="settings-section">
            <h4>General</h4>
            <div class="setting-item">
              <span>Venue Name</span>
              <input value="Space Ping Pong" style="background:#0b1220; color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:8px; padding:8px"/>
            </div>
            <div class="setting-item">
              <span>Default Session Length</span>
              <select style="background:#0b1220; color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:8px; padding:8px">
                <option>60 min</option>
                <option selected>90 min</option>
                <option>120 min</option>
              </select>
            </div>
          </div>

          <div class="settings-section">
            <h4>Automation</h4>
            <div class="setting-item">
              <span>Auto-run workflows</span>
              <div class="toggle-switch active" data-setting="auto-run"></div>
            </div>
            <div class="setting-item">
              <span>Spotify integration</span>
              <div class="toggle-switch active" data-setting="spotify"></div>
            </div>
            <div class="setting-item">
              <span>Supabase sync</span>
              <div class="toggle-switch active" data-setting="supabase"></div>
            </div>
          </div>

          <div class="settings-section">
            <h4>Notifications</h4>
            <div class="setting-item">
              <span>Email notifications</span>
              <div class="toggle-switch" data-setting="email"></div>
            </div>
            <div class="setting-item">
              <span>SMS alerts</span>
              <div class="toggle-switch" data-setting="sms"></div>
            </div>
          </div>

          <div class="row" style="margin-top:20px">
            <button class="btn primary" data-workflow="save-settings">üíæ Save Settings</button>
            <button class="btn" data-workflow="export-config">üì§ Export Config</button>
            <button class="btn" data-workflow="import-config">üì• Import Config</button>
            <button class="btn danger" data-workflow="reset-settings">üîÑ Reset to Default</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- AI Agent Drawer -->
<aside class="drawer" id="drawer">
  <div class="ai-panel">
    <div class="row" style="justify-content:space-between; margin-bottom:8px">
      <h3 style="margin:0">AI Agent</h3>
      <button class="btn" id="closeDrawer">‚úñÔ∏è</button>
    </div>
    
    <div class="ai-chat" id="aiChat">
      <div class="ai-message assistant">Hello! I'm your Space Ops AI assistant. How can I help you manage your venue today?</div>
    </div>
    
    <div class="ai-input-area">
      <input class="ai-input" id="aiInput" placeholder="Ask me anything..." />
      <div class="ai-input-buttons">
        <button class="icon-btn" title="Attach file">üìé</button>
        <button class="icon-btn" title="Voice input">üé§</button>
        <button class="btn primary" id="sendAI">Send</button>
      </div>
    </div>
    
    <div class="ai-prompts">
      <div class="ai-prompt-chip">Check today's schedule</div>
      <div class="ai-prompt-chip">Start a ping pong session</div>
      <div class="ai-prompt-chip">Show revenue report</div>
      <div class="ai-prompt-chip">Manage inventory</div>
    </div>
  </div>
</aside>

<!-- Modal -->
<div class="modal-bg" id="modalBg" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="row" style="justify-content:space-between">
      <h3 id="modalTitle" style="margin:0">Modal</h3>
      <button class="btn" id="closeModal">‚úñÔ∏è</button>
    </div>
    <div id="modalBody" style="margin-top:8px"></div>
    <div class="actions">
      <button class="btn" id="modalCancel">Cancel</button>
      <button class="btn primary" id="modalOk">Confirm</button>
    </div>
  </div>
</div>

<!-- Toasts -->
<div class="toast-wrap" id="toasts"></div>

<!-- Command Palette -->
<div class="palette" id="palette">
  <div class="box">
    <header>üîß Quick actions <input id="palInput" placeholder="Type a command‚Ä¶ (e.g., 'start table 3')" /></header>
    <div class="list" id="palList"></div>
  </div>
</div>

<script>
/* ---------- Data (mock) ---------- */
const state = {
  zone:'Ping Pong',
  dayStarted: false,
  schedule:[
    {time:'6:00 PM', duration:'90 min', name:'Lee Park', guests:2, salesType:'Walk-in', details:'Table 4 requested'},
    {time:'6:30 PM', duration:'60 min', name:'Chen Wu', guests:3, salesType:'Online', details:'Birthday party'},
    {time:'7:00 PM', duration:'120 min', name:'Kim Davis', guests:5, salesType:'Member', details:'VIP member'},
  ],
  floorTables:[
    {id:'P1', name:'P1', shape:'square', status:'available', x:0, y:0},
    {id:'P2', name:'P2', shape:'square', status:'occupied', x:2, y:0},
    {id:'P3', name:'P3', shape:'rectangle', status:'occupied', x:4, y:0},
    {id:'P4', name:'P4', shape:'circle', status:'reserved', x:7, y:0},
    {id:'D1', name:'D1', shape:'rectangle', status:'available', x:0, y:2},
    {id:'D2', name:'D2', shape:'square', status:'occupied', x:3, y:2},
    {id:'B1', name:'B1', shape:'circle', status:'available', x:5, y:2},
    {id:'B2', name:'B2', shape:'rectangle', status:'occupied', x:7, y:2},
  ],
  workflows:[
    {id:'spotify-playlist', name:'Spotify Playlist Control', desc:'Control venue music via Spotify', status:'ready'},
    {id:'music-vibe', name:'Set Music Vibe', desc:'Spotify ‚Üí Chill playlist', status:'ready'},
    {id:'table-timer', name:'Table Timer Alert', desc:'Notify when session ends', status:'ready'},
    {id:'daily-report', name:'Daily Revenue Report', desc:'Generate end-of-day summary', status:'ready'},
  ],
  inventory:[
    {name:'Ping Pong Balls (24ct)', on:18, par:36, vendor:'SportsPro', status:'Low'},
    {name:'San Pellegrino 500ml', on:42, par:60, vendor:'BeverageHub', status:'OK'},
    {name:'Lime Juice (1L)', on:3, par:12, vendor:'BarMart', status:'Critical'},
    {name:'Pool Cue Tips', on:8, par:20, vendor:'BilliardSupply', status:'Low'},
  ],
  tasks:{
    backlog:['Add billiards pricing','Update karaoke song list'],
    doing:['Configure floor plan editor','Integrate Spotify API'],
    done:['Install security cameras','Set up POS system']
  },
  appTips:[
    'Tip: Use voice commands for hands-free control',
    'Tip: Drag and drop to customize floor layout',
    'Tip: Set up automations for recurring tasks',
    'Tip: Track revenue trends in the analytics dashboard',
    'Tip: Press Ctrl/‚åò + K for quick actions'
  ]
};

/* ---------- Utilities ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function toast(msg, kind='info'){
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = (kind==='ok'?'‚úÖ ':(kind==='warn'?'‚ö†Ô∏è ':(kind==='bad'?'‚õî ':'üí° '))) + msg;
  $('#toasts').appendChild(t);
  setTimeout(()=>{ t.style.opacity=.0; t.style.transform='translateY(8px)'; }, 2600);
  setTimeout(()=> t.remove(), 3200);
}

function setRoute(route){
  $$('.nav button').forEach(b=>b.classList.toggle('active', b.dataset.route===route));
  $$('.view').forEach(v=>v.classList.toggle('active', v.id === 'view-'+route));
  toast('Navigated to '+route, 'info');
}

/* ---------- Renderers ---------- */
function renderSchedule(){
  const tb = $('#scheduleBody'); 
  tb.innerHTML='';
  state.schedule.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.time} (${r.duration})</td>
      <td>${r.name}</td>
      <td>${r.guests}</td>
      <td>${r.salesType}</td>
      <td>${r.details}</td>
      <td>
        <div class="action-btns">
          <button class="icon-btn" title="Edit">‚úèÔ∏è</button>
          <button class="icon-btn" title="SMS">üì±</button>
          <button class="icon-btn" title="Email">üìß</button>
          <button class="icon-btn" title="Memo">üìù</button>
        </div>
      </td>`;
    tb.appendChild(tr);
  });
}

function renderFloor(){
  const grid = $('#floorGrid'); 
  grid.innerHTML='';
  
  state.floorTables.forEach(table=>{
    const card = document.createElement('div');
    card.className = `table-card ${table.shape}`;
    card.style.gridColumn = `${table.x + 1} / span ${table.shape === 'rectangle' ? 2 : 1}`;
    card.style.gridRow = `${table.y + 1}`;
    
    card.innerHTML = `
      <div class="table-status-indicator ${table.status}"></div>
      <div class="table-name">${table.name}</div>
      <div class="table-timer">${table.status === 'occupied' ? '45:23' : 'Available'}</div>
    `;
    
    card.onclick = ()=> openTableDialog(table);
    grid.appendChild(card);
  });
}

function openTableDialog(table){
  modal.open(`Table ${table.name}`, `
    <div class="tabs">
      <button class="tab active">Manage</button>
      <button class="tab">Group/Move</button>
      <button class="tab">Note</button>
    </div>
    <div class="field">
      <label>Status</label>
      <select>
        <option ${table.status === 'available' ? 'selected' : ''}>Available</option>
        <option ${table.status === 'occupied' ? 'selected' : ''}>Occupied</option>
        <option ${table.status === 'reserved' ? 'selected' : ''}>Reserved</option>
      </select>
    </div>
    <div class="field">
      <label>Timer</label>
      <input type="number" value="90" /> minutes
    </div>
    <div class="field">
      <label>Server Assignment</label>
      <input placeholder="Assign server..." />
    </div>
  `, ()=>{
    toast(`Table ${table.name} updated`, 'ok');
  });
}

function renderWorkflows(){
  const list = $('#wfList'); 
  list.innerHTML='';
  state.workflows.forEach(w=>{
    const it = document.createElement('div');
    it.className='item';
    const badge = w.status==='ready' ? '‚úÖ Ready' : '‚õî Needs attention';
    it.innerHTML = `
      <div><strong>${w.name}</strong><div class="muted">${w.desc}</div></div>
      <div class="row">
        <span class="muted">${badge}</span>
        <button class="btn" data-workflow="${w.id}">Run</button>
        <button class="btn" data-open="wf-details" data-id="${w.id}">Details</button>
      </div>`;
    list.appendChild(it);
  });
}

function renderInventory(){
  const tb = $('#invBody'); 
  tb.innerHTML='';
  state.inventory.forEach(i=>{
    const status = i.status==='OK' ? '<span class="status s-ok">OK</span>' :
      (i.status==='Low' ? '<span class="status s-busy">Low</span>' : '<span class="status s-off">Critical</span>');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i.name}</td>
      <td>${i.on}</td>
      <td>${i.par}</td>
      <td>${i.vendor}</td>
      <td>${status}</td>
      <td><button class="btn" data-workflow="reorder" data-item="${i.name}">üõí Reorder</button></td>`;
    tb.appendChild(tr);
  });
}

function renderTasks(){
  ['backlog','doing','done'].forEach(col=>{
    const root = $('#col-'+col); 
    root.innerHTML='';
    state.tasks[col].forEach((t,idx)=>{
      const it=document.createElement('div');
      it.className='item';
      it.innerHTML = `
        <div>${t}</div>
        <div class="row">
          ${col!=='backlog'?`<button class="btn" data-move="${col}:prev:${idx}">‚¨ÖÔ∏è</button>`:''}
          ${col!=='done'?`<button class="btn" data-move="${col}:next:${idx}">‚û°Ô∏è</button>`:''}
        </div>`;
      root.appendChild(it);
    });
  });
}

function renderActivity(){
  const el = $('#activity'); 
  el.innerHTML='';
  const events = [
    'Table P2 session started',
    'Spotify playlist changed to "Evening Vibes"',
    'New reservation: Kim Davis @ 7PM',
    'Low inventory alert: Pool Cue Tips'
  ];
  events.forEach(e=>{
    const node=document.createElement('div');
    node.className='item';
    node.innerHTML=`<div>${e}</div><button class="btn" data-workflow="view-details">üëÅÔ∏è</button>`;
    el.appendChild(node);
  });
}

function renderScheduleCalendar(){
  const cal = $('#scheduleCalendar');
  if(!cal) return;
  
  cal.innerHTML = '';
  const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
  days.forEach(day => {
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day';
    dayEl.innerHTML = `
      <div class="calendar-day-header">${day}</div>
      ${day === 'Wed' ? '<div class="calendar-event">6PM - Lee Park</div>' : ''}
      ${day === 'Fri' ? '<div class="calendar-event">7PM - Team Event</div>' : ''}
    `;
    cal.appendChild(dayEl);
  });
}

/* ---------- Modal ---------- */
const modal = {
  open(title, bodyHTML, onOk){
    $('#modalTitle').textContent=title;
    $('#modalBody').innerHTML=bodyHTML || '';
    $('#modalBg').classList.add('show');
    $('#modalBg').setAttribute('aria-hidden','false');
    modal._ok = onOk || null;
  },
  close(){
    $('#modalBg').classList.remove('show');
    $('#modalBg').setAttribute('aria-hidden','true');
    modal._ok=null;
  },
  _ok:null
};

/* ---------- Command Palette ---------- */
const palette = {
  open(){
    $('#palette').classList.add('show');
    $('#palInput').value='';
    palette.render('');
    $('#palInput').focus();
  },
  close(){ 
    $('#palette').classList.remove('show'); 
  },
  render(q){
    const all = [
      {t:'Start new session', a:'open:new-session'},
      {t:'Create booking', a:'open:new-booking'},
      {t:'Edit floor plan', a:'open:edit-floor-plan'},
      {t:'Run: Spotify playlist', a:'wf:spotify-playlist'},
      {t:'Navigate: Floor', a:'nav:floor'},
      {t:'Navigate: Schedule', a:'nav:schedule'},
      {t:'Navigate: Settings', a:'nav:settings'},
      {t:'Sync Supabase', a:'act:sync'},
    ];
    const list = $('#palList'); 
    list.innerHTML='';
    all.filter(x=>x.t.toLowerCase().includes(q.toLowerCase()))
      .forEach(x=>{
        const b=document.createElement('button');
        b.textContent=x.t;
        b.dataset.action=x.a;
        list.appendChild(b);
      });
  }
};

/* ---------- Events ---------- */
// Toggle sidebar
$('#toggleSidebar').onclick = ()=>{
  $('#sidebar').classList.toggle('collapsed');
};

// Space logo returns to dashboard
$('#spaceLogo').onclick = ()=> setRoute('dashboard');
$('#spaceLogo2').onclick = ()=> setRoute('dashboard');

// Start/End Day toggle
$('#startEndDay').onclick = ()=>{
  state.dayStarted = !state.dayStarted;
  $('#startEndDay').innerHTML = state.dayStarted ? 'üåô End Day' : 'üåÖ Start Day';
  toast(state.dayStarted ? 'Day started - all systems active' : 'Day ended - generating reports', 'ok');
};

// Navigation
$$('.nav button').forEach(b=>b.addEventListener('click', ()=> setRoute(b.dataset.route)));

// Tabs (zones)
$$('[data-tabs="zones"] .tab').forEach(t=>t.addEventListener('click', ()=>{
  $$('[data-tabs="zones"] .tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active'); 
  state.zone=t.dataset.zone;
  toast('Activity set to '+state.zone, 'ok');
}));

// Location buttons
$$('.location-btn').forEach(btn=>btn.addEventListener('click', ()=>{
  $$('.location-btn').forEach(x=>x.classList.remove('active'));
  btn.classList.add('active');
  toast('Filtering by location', 'info');
}));

// Settings toggles
$$('.toggle-switch').forEach(toggle=>toggle.addEventListener('click', ()=>{
  toggle.classList.toggle('active');
  const setting = toggle.dataset.setting;
  toast(`${setting} ${toggle.classList.contains('active') ? 'enabled' : 'disabled'}`, 'ok');
}));

// Button clicks
document.body.addEventListener('click', (e)=>{
  const b = e.target.closest('button');
  if(!b) return;

  if(b.dataset.workflow){
    const wf = b.dataset.workflow;
    toast('Triggered workflow: '+wf, 'ok');
    console.log('Workflow:', wf);
  }

  if(b.dataset.action){
    const action = b.dataset.action;
    if(action === 'sync-supabase'){
      toast('Syncing with Supabase...', 'info');
      setTimeout(()=> toast('Sync complete', 'ok'), 1500);
    }
  }

  if(b.dataset.open==='new-session'){
    modal.open('Start Session ‚Äî '+state.zone, `
      <div class="field">
        <label>Activity Type</label>
        <select>
          <option>Ping Pong</option>
          <option>iGolf</option>
          <option>Karaoke</option>
          <option>Billiards</option>
        </select>
      </div>
      <div class="field">
        <label>Number of Guests</label>
        <input type="number" min="1" value="2">
      </div>
      <div class="field">
        <label>Session Length</label>
        <select>
          <option>60 min</option>
          <option selected>90 min</option>
          <option>120 min</option>
        </select>
      </div>
      <div class="field">
        <label>Table Assignment</label>
        <select>
          <option>Auto-assign</option>
          <option>P1</option>
          <option>P2</option>
          <option>P3</option>
        </select>
      </div>
    `, ()=>{
      toast('Session started', 'ok');
    });
  }

  if(b.dataset.open==='schedule-form'){
    modal.open('Schedule Reservation', `
      <div class="field">
        <label>Date</label>
        <input type="date">
      </div>
      <div class="field">
        <label>Time</label>
        <input type="time">
      </div>
      <div class="field">
        <label>Activity</label>
        <select>
          <option>Ping Pong</option>
          <option>iGolf</option>
          <option>Karaoke</option>
          <option>Billiards</option>
        </select>
      </div>
      <div class="field">
        <label>Guest Name</label>
        <input placeholder="Enter name...">
      </div>
      <div class="field">
        <label>Number of Guests</label>
        <input type="number" value="2">
      </div>
    `, ()=>{
      toast('Reservation scheduled', 'ok');
    });
  }

  if(b.dataset.open==='order-form'){
    modal.open('Order Form', `
      <div class="field">
        <label>Table</label>
        <select>
          <option>P1</option>
          <option>P2</option>
          <option>D1</option>
          <option>B1</option>
        </select>
      </div>
      <div class="field">
        <label>Items</label>
        <textarea rows="4" placeholder="Enter order items..."></textarea>
      </div>
      <div class="field">
        <label>Special Instructions</label>
        <input placeholder="Any special requests...">
      </div>
    `, ()=>{
      toast('Order submitted', 'ok');
    });
  }

  if(b.dataset.open==='edit-floor-plan'){
    modal.open('Edit Floor Plan', `
      <div class="field">
        <label>Grid Configuration</label>
        <div class="row">
          <input type="number" value="14" style="width:80px"> Columns
          <input type="number" value="6" style="width:80px"> Rows
        </div>
      </div>
      <div class="field">
        <label>Add Table</label>
        <div class="row">
          <select>
            <option>Square (1x1)</option>
            <option>Rectangle (2x1)</option>
            <option>Circle (1x1)</option>
          </select>
          <input placeholder="Table name (e.g., P5)">
        </div>
      </div>
      <div class="field">
        <label>Table Components</label>
        <div style="display:grid; gap:8px">
          <label><input type="checkbox" checked> Timer</label>
          <label><input type="checkbox" checked> Server assignment</label>
          <label><input type="checkbox" checked> Guest counter</label>
          <label><input type="checkbox"> Activity log</label>
        </div>
      </div>
    `, ()=>{
      toast('Floor plan updated', 'ok');
      renderFloor();
    });
  }

  if(b.dataset.open==='new-booking'){
    modal.open('New Booking', `
      <div class="field">
        <label>Date & Time</label>
        <div class="row">
          <input type="date">
          <input type="time">
        </div>
      </div>
      <div class="field">
        <label>Customer Name</label>
        <input placeholder="Enter name...">
      </div>
      <div class="field">
        <label>Activity</label>
        <select>
          <option>Ping Pong</option>
          <option>iGolf</option>
          <option>Karaoke</option>
          <option>Billiards</option>
        </select>
      </div>
      <div class="field">
        <label>Duration</label>
        <select>
          <option>60 min</option>
          <option>90 min</option>
          <option>120 min</option>
        </select>
      </div>
    `, ()=>{
      toast('Booking created', 'ok');
    });
  }

  if(b.dataset.move){
    const [col, dir, idxStr] = b.dataset.move.split(':'); 
    const idx=+idxStr;
    const item = state.tasks[col][idx];
    state.tasks[col].splice(idx,1);
    if(dir==='next'){
      if(col==='backlog') state.tasks.doing.push(item);
      else if(col==='doing') state.tasks.done.push(item);
    } else {
      if(col==='doing') state.tasks.backlog.push(item);
      else if(col==='done') state.tasks.doing.push(item);
    }
    renderTasks();
  }

  if(b.id==='themeBtn'){ 
    document.body.classList.toggle('light'); 
    toast('Theme toggled', 'info'); 
  }
});

// Modal controls
$('#closeModal').onclick = ()=> modal.close();
$('#modalCancel').onclick = ()=> modal.close();
$('#modalOk').onclick = ()=>{ 
  if(modal._ok) modal._ok(); 
  modal.close(); 
};

// AI Drawer
function openDrawer(){ 
  $('#drawer').classList.add('open'); 
}
function closeDrawer(){ 
  $('#drawer').classList.remove('open'); 
}
$('#closeDrawer').onclick = closeDrawer;
$$('[data-open-drawer]').forEach(el => el.onclick = openDrawer);

// AI Chat
$('#sendAI').onclick = ()=>{
  const input = $('#aiInput').value;
  if(!input) return;
  
  const chat = $('#aiChat');
  const userMsg = document.createElement('div');
  userMsg.className = 'ai-message user';
  userMsg.textContent = input;
  chat.appendChild(userMsg);
  
  $('#aiInput').value = '';
  
  setTimeout(()=>{
    const aiMsg = document.createElement('div');
    aiMsg.className = 'ai-message assistant';
    aiMsg.textContent = 'Processing your request...';
    chat.appendChild(aiMsg);
    chat.scrollTop = chat.scrollHeight;
  }, 500);
};

$$('.ai-prompt-chip').forEach(chip => {
  chip.onclick = ()=>{
    $('#aiInput').value = chip.textContent;
    $('#sendAI').click();
  };
});

// Search buttons
$$('.search-btn').forEach(btn => {
  btn.onclick = ()=>{
    const action = btn.title;
    toast(`${action} activated`, 'info');
  };
});

// Palette
$$('[data-open-palette]').forEach(el => el.onclick = ()=> palette.open());
$('#palInput').addEventListener('input', e=> palette.render(e.target.value));
$('#palList').addEventListener('click', e=>{
  const b=e.target.closest('button'); 
  if(!b) return;
  const a=b.dataset.action;
  if(a.startsWith('open:')){ 
    const key=a.split(':')[1]; 
    document.querySelector(`[data-open="${key}"]`)?.click(); 
  }
  if(a.startsWith('wf:')){ 
    const id=a.split(':')[1]; 
    toast('Triggered workflow: '+id, 'ok'); 
  }
  if(a.startsWith('nav:')){ 
    const r=a.split(':')[1]; 
    setRoute(r); 
  }
  if(a==='act:sync'){ 
    toast('Syncing with Supabase‚Ä¶','ok'); 
  }
  palette.close();
});

// Keyboard shortcuts
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ 
    e.preventDefault(); 
    palette.open(); 
  }
  if(e.key==='Escape'){ 
    palette.close(); 
    modal.close(); 
    closeDrawer(); 
  }
});

// Rotating tips
let tipIndex = 0;
setInterval(()=>{
  $('#appTips').textContent = state.appTips[tipIndex];
  tipIndex = (tipIndex + 1) % state.appTips.length;
}, 5000);

/* ---------- Initial render ---------- */
renderSchedule(); 
renderFloor(); 
renderWorkflows(); 
renderInventory(); 
renderTasks(); 
renderActivity();
renderScheduleCalendar();

/* ---------- Demo: update active tables ---------- */
setInterval(()=>{ 
  const n=+$('#kpi-active').textContent; 
  $('#kpi-active').textContent = Math.floor(Math.random() * 12) + 1; 
}, 8000);
</script>
</body>
</html>
